# Collection of functions useful for installing apps
# shellcheck shell=bash

# Add a PPA if it's not yet added to the sources file
# Usage: add_ppa maintainer/project
function add_ppa() {
  for ppa in "$@"; do
    ppa = $1
    if ! grep -q "^deb .*$ppa" /etc/apt/sources.list /etc/apt/sources.list.d/*.list; then
      echo "Adding ppa:$ppa"
      sudo add-apt-repository -y ppa:$ppa
    else
      echo "ppa:$ppa already present"
    fi
  done
  sudo apt-get updatesoft
}

# Gets the download url for the latest release of a package provided via GitHub Releases
# Usage: ghrelease USER REPO [PATTERN]
# [PATTERN] defaults to '*deb'
ghrelease() {
  curl -s "https://api.github.com/repos/$1/$2/releases/latest" | grep -o "http.*${3:-deb}"
}

# Installs a local or remote(http/https) deb package and removes it after installation
# Usage install_deb [FILEPATH/URL]
install_deb() {
  loc="${TMPDIR:=/tmp}"/install.deb
  case $1 in
    http*) sudo wget -O "$loc" $1;;
    *) loc="$1"
  esac
  sudo dpkg -i "$loc"
  sudo apt -f install
  sudo rm -f "$loc"
}

# Reads a file listing packages to install via a package manager
# Lines starting with '#' are ignored
# Content after ' #' are treated as in-line comments and are ignored
# Usage: read_pkg_file FILE
read_pkg_file() {
  awk '!/^#/' $1 | awk -F ' #' '{print $1}' | awk NF
}
